<app-dashboard-navbar
  [disableTipoPessoa]="activeAction === 'reportLeads'"
  (tipoPessoaChange)="onTipoPessoaChange()"></app-dashboard-navbar>

<!-- Toast Notification -->
<div class="toast-notification" [class.show]="showToast()">
  <svg class="toast-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <polyline points="20 6 9 17 4 12"></polyline>
  </svg>
  <span>{{ toastMessage() }}</span>
</div>

<div class="dashboard-layout" [class.selection-mode]="selectedLeadIndex() !== null">
  <!-- Menu Lateral (Aside) -->
  <aside class="sidebar" [class.open]="sidebarOpen()">
    <!-- Botão Hamburger / Collapse -->
    <button class="hamburger-btn" (click)="toggleSidebar()" [class.open]="sidebarOpen()">
      <!-- Linhas do hamburger (visíveis quando fechado) -->
      <span></span>
      <span></span>
      <span></span>
      <!-- Ícone de seta para a esquerda (visível quando aberto) -->
      <svg class="arrow-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="15 18 9 12 15 6"></polyline>
      </svg>
    </button>

    <div class="sidebar-header" *ngIf="sidebarOpen()">
      <h3>Dashboard</h3>
    </div>

    <nav class="sidebar-menu">
      <!-- Gerenciamento de Clientes -->
      <div class="menu-category" *ngIf="canAccessClientes()">
        <div class="category-header" (click)="onCategoryHeaderClick('clientes')">
          <span class="category-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
              <circle cx="9" cy="7" r="4"></circle>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
          </span>
          <span class="category-title" *ngIf="sidebarOpen()">Clientes {{ tipoPessoa }}</span>
          <svg *ngIf="sidebarOpen()" class="collapse-icon" [class.expanded]="isMenuExpanded('clientes')" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
          <span class="category-tooltip" *ngIf="!sidebarOpen()">Clientes {{ tipoPessoa }}</span>
        </div>
        <div class="category-items" [class.show]="sidebarOpen() && isMenuExpanded('clientes')" *ngIf="sidebarOpen()">
          <button
            *ngIf="canAccessListAll()"
            class="menu-item"
            [class.active]="activeAction === 'list'"
            (click)="setActiveAction('list')">
            <span class="icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="8" y1="6" x2="21" y2="6"></line>
                <line x1="8" y1="12" x2="21" y2="12"></line>
                <line x1="8" y1="18" x2="21" y2="18"></line>
                <line x1="3" y1="6" x2="3.01" y2="6"></line>
                <line x1="3" y1="12" x2="3.01" y2="12"></line>
                <line x1="3" y1="18" x2="3.01" y2="18"></line>
              </svg>
            </span>
            <span class="item-text">Listar todos</span>
          </button>

          <button
            *ngIf="canAccessSearchByCpfCnpj()"
            class="menu-item"
            [class.active]="activeAction === 'searchByCpfCnpj'"
            (click)="setActiveAction('searchByCpfCnpj')">
            <span class="icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
              </svg>
            </span>
            <span class="item-text">Buscar por {{ tipoPessoa === 'PF' ? 'CPF' : 'CNPJ' }}</span>
          </button>

          <button
            *ngIf="canAccessSearchByUuid()"
            class="menu-item"
            [class.active]="activeAction === 'searchByUuid'"
            (click)="setActiveAction('searchByUuid')">
            <span class="icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
              </svg>
            </span>
            <span class="item-text">Buscar por UUID</span>
          </button>

          <button
            class="menu-item disabled"
            [class.active]="activeAction === 'update'"
            title="Funcionalidade futura">
            <span class="icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
              </svg>
            </span>
            <span class="item-text">Atualizar dados</span>
          </button>

          <button
            class="menu-item disabled"
            [class.active]="activeAction === 'listInactive'"
            title="Funcionalidade futura">
            <span class="icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="8.5" cy="7" r="4"></circle>
                <line x1="18" y1="8" x2="23" y2="13"></line>
                <line x1="23" y1="8" x2="18" y2="13"></line>
              </svg>
            </span>
            <span class="item-text">Clientes Inativos</span>
          </button>
        </div>
      </div>

      <!-- Relatórios -->
      <div class="menu-category" *ngIf="canAccessReports()">
        <div class="category-header" (click)="onCategoryHeaderClick('relatorios')">
          <span class="category-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="20" x2="18" y2="10"></line>
              <line x1="12" y1="20" x2="12" y2="4"></line>
              <line x1="6" y1="20" x2="6" y2="14"></line>
            </svg>
          </span>
          <span class="category-title" *ngIf="sidebarOpen()">Relatórios</span>
          <svg *ngIf="sidebarOpen()" class="collapse-icon" [class.expanded]="isMenuExpanded('relatorios')" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
          <span class="category-tooltip" *ngIf="!sidebarOpen()">Relatórios</span>
        </div>
        <div class="category-items" [class.show]="sidebarOpen() && isMenuExpanded('relatorios')" *ngIf="sidebarOpen()">
          <button
            class="menu-item"
            [class.active]="activeAction === 'reportLeads'"
            (click)="setActiveAction('reportLeads')">
            <span class="icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="8.5" cy="7" r="4"></circle>
                <path d="M20 8v6M23 11h-6"></path>
              </svg>
            </span>
            <span class="item-text">Leads</span>
          </button>

          <button
            class="menu-item disabled"
            [class.active]="activeAction === 'reportClientesPorRegiao'"
            title="Funcionalidade futura">
            <span class="icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="10" r="3"></circle>
                <path d="M12 21.7C17.3 17 20 13 20 10a8 8 0 1 0-16 0c0 3 2.7 6.9 8 11.7z"></path>
              </svg>
            </span>
            <span class="item-text">Clientes por Região</span>
          </button>

          <button
            class="menu-item disabled"
            [class.active]="activeAction === 'reportTopVendedores'"
            title="Funcionalidade futura">
            <span class="icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                <polyline points="17 6 23 6 23 12"></polyline>
              </svg>
            </span>
            <span class="item-text">Top Vendedores</span>
          </button>

          <button
            class="menu-item disabled"
            [class.active]="activeAction === 'reportTopCompradores'"
            title="Funcionalidade futura">
            <span class="icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="9" cy="21" r="1"></circle>
                <circle cx="20" cy="21" r="1"></circle>
                <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
              </svg>
            </span>
            <span class="item-text">Top Compradores</span>
          </button>

          <button
            class="menu-item disabled"
            [class.active]="activeAction === 'reportClientesBloqueados'"
            title="Funcionalidade futura">
            <span class="icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
              </svg>
            </span>
            <span class="item-text">Clientes Bloqueados</span>
          </button>

          <button
            class="menu-item disabled"
            [class.active]="activeAction === 'reportNovosClientes'"
            title="Funcionalidade futura">
            <span class="icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
                <path d="M22 9h-6"></path>
              </svg>
            </span>
            <span class="item-text">Novos Clientes</span>
          </button>

          <button
            class="menu-item disabled"
            [class.active]="activeAction === 'reportFaixaEtaria'"
            title="Funcionalidade futura">
            <span class="icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="20" x2="12" y2="10"></line>
                <line x1="18" y1="20" x2="18" y2="4"></line>
                <line x1="6" y1="20" x2="6" y2="16"></line>
              </svg>
            </span>
            <span class="item-text">Clientes por Faixa Etária</span>
          </button>

          <button
            class="menu-item disabled"
            [class.active]="activeAction === 'reportPorTipoCliente'"
            title="Funcionalidade futura">
            <span class="icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="7" height="7"></rect>
                <rect x="14" y="3" width="7" height="7"></rect>
                <rect x="14" y="14" width="7" height="7"></rect>
                <rect x="3" y="14" width="7" height="7"></rect>
              </svg>
            </span>
            <span class="item-text">Por Tipo de Cliente</span>
          </button>

          <button
            class="menu-item disabled"
            [class.active]="activeAction === 'reportEstadoCivil'"
            title="Funcionalidade futura">
            <span class="icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
              </svg>
            </span>
            <span class="item-text">Por Estado Civil</span>
          </button>

          <button
            class="menu-item disabled"
            [class.active]="activeAction === 'reportVolumeVendas'"
            title="Funcionalidade futura">
            <span class="icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="1" x2="12" y2="23"></line>
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
              </svg>
            </span>
            <span class="item-text">Volume de Vendas</span>
          </button>

          <button
            class="menu-item disabled"
            [class.active]="activeAction === 'reportOrigemLead'"
            title="Funcionalidade futura">
            <span class="icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
              </svg>
            </span>
            <span class="item-text">Por Origem de Lead</span>
          </button>

          <button
            class="menu-item disabled"
            [class.active]="activeAction === 'reportPFvsPJ'"
            title="Funcionalidade futura">
            <span class="icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                <line x1="12" y1="22.08" x2="12" y2="12"></line>
              </svg>
            </span>
            <span class="item-text">PF vs PJ</span>
          </button>
        </div>
      </div>

      <!-- Financeiro -->
      <div class="menu-category" *ngIf="canAccessFinanceiro()">
        <div class="category-header" (click)="onCategoryHeaderClick('financeiro')">
          <span class="category-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="1" x2="12" y2="23"></line>
              <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
            </svg>
          </span>
          <span class="category-title" *ngIf="sidebarOpen()">Financeiro</span>
          <svg *ngIf="sidebarOpen()" class="collapse-icon" [class.expanded]="isMenuExpanded('financeiro')" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
          <span class="category-tooltip" *ngIf="!sidebarOpen()">Financeiro</span>
        </div>
        <div class="category-items" [class.show]="sidebarOpen() && isMenuExpanded('financeiro')" *ngIf="sidebarOpen()">
          <p class="coming-soon">Em breve...</p>
        </div>
      </div>

      <!-- Configurações -->
      <div class="menu-category" *ngIf="canAccessConfiguracoes()">
        <div class="category-header" (click)="onCategoryHeaderClick('configuracoes')">
          <span class="category-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <!-- Ícone de engrenagem simétrico: aro externo, núcleo e 8 dentes -->
              <circle cx="12" cy="12" r="7"></circle>
              <circle cx="12" cy="12" r="3"></circle>
              <path d="M12 2v3"></path>
              <path d="M12 19v3"></path>
              <path d="M2 12h3"></path>
              <path d="M19 12h3"></path>
              <path d="M4.93 4.93l2.12 2.12"></path>
              <path d="M17.07 17.07l2.12 2.12"></path>
              <path d="M4.93 19.07l2.12-2.12"></path>
              <path d="M17.07 6.93l2.12-2.12"></path>
            </svg>
          </span>
          <span class="category-title" *ngIf="sidebarOpen()">Configurações</span>
          <svg *ngIf="sidebarOpen()" class="collapse-icon" [class.expanded]="isMenuExpanded('configuracoes')" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
          <span class="category-tooltip" *ngIf="!sidebarOpen()">Configurações</span>
        </div>
        <div class="category-items" [class.show]="sidebarOpen() && isMenuExpanded('configuracoes')" *ngIf="sidebarOpen()">
          <button
            *ngIf="canAccessPasswordReset()"
            class="menu-item"
            [class.active]="activeAction === 'passwordReset'"
            (click)="setActiveAction('passwordReset')">
            <span class="icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
              </svg>
            </span>
            <span class="item-text">Reset de Senha</span>
          </button>
        </div>
      </div>

      <!-- Ajuda -->
      <div class="menu-category">
        <div class="category-header" (click)="onCategoryHeaderClick('ajuda')">
          <span class="category-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
              <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
          </span>
          <span class="category-title" *ngIf="sidebarOpen()">Ajuda</span>
          <svg *ngIf="sidebarOpen()" class="collapse-icon" [class.expanded]="isMenuExpanded('ajuda')" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
          <span class="category-tooltip" *ngIf="!sidebarOpen()">Ajuda</span>
        </div>
        <div class="category-items" [class.show]="sidebarOpen() && isMenuExpanded('ajuda')" *ngIf="sidebarOpen()">
          <p class="coming-soon">Em breve...</p>
        </div>
      </div>
    </nav>

    <div class="sidebar-footer" *ngIf="sidebarOpen()">
      <button class="logout-btn" title="Sair">Sair</button>
      <p class="note">Funcionalidades controladas por ROLES</p>
    </div>
    <div class="sidebar-footer collapsed" *ngIf="!sidebarOpen()">
      <button class="logout-icon-btn" title="Sair">
        <svg class="logout-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="6" y="3" width="12" height="18" rx="2"></rect>
          <circle cx="15" cy="12" r="1"></circle>
        </svg>
      </button>
    </div>
  </aside>

  <!-- Área Principal de Conteúdo -->
  <main class="main-content">
    <!-- Overlay para escurecer o dashboard quando houver seleção -->
    <div class="dashboard-overlay" *ngIf="selectedLeadIndex() !== null" (click)="clearLeadSelection()"></div>
    <!-- Breadcrumbs -->
    <app-breadcrumbs [breadcrumbs]="breadcrumbs()"></app-breadcrumbs>

    <!-- Estado Inicial: Nenhuma ação selecionada -->
    <div *ngIf="!activeAction" class="welcome-screen">
      <h2>Bem-vindo ao Painel de Controle</h2>
      <p>Selecione uma opção no menu lateral para começar</p>
    </div>

    <!-- Loading -->
    <div *ngIf="loading()" class="loading-overlay">
      <app-loading [message]="loadingMessage()" size="large" type="progress-bar"></app-loading>
    </div>

    <!-- Mensagem de Erro -->
    <div *ngIf="error()" class="error-message">
      <span class="error-icon">⚠️</span>
      {{ error() }}
      <button class="close-error" (click)="error.set(null)">✕</button>
    </div>

    <!-- Listar Todos os Clientes -->
    <div *ngIf="activeAction === 'list' && !loading()" class="action-content">
      <div class="content-header">
        <h2>Lista de Clientes {{ tipoPessoa }}</h2>
        <div class="header-actions">
          <div class="auto-reload-control" title="Auto-reload">
            <select class="auto-reload-select" [value]="autoReloadMinutes()" (change)="setAutoReload($any($event.target).value)">
              <option value="5">5 min</option>
              <option value="10">10 min</option>
              <option value="20">20 min</option>
              <option value="30">30 min</option>
              <option value="60">60 min</option>
            </select>
          </div>
          <button class="action-btn primary" (click)="loadClientes()">
            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="23 4 23 10 17 10"></polyline>
              <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
            </svg>
            Atualizar
          </button>
        </div>
      </div>

      <div *ngIf="(tipoPessoa === 'PF' && clientesPF().length > 0) || (tipoPessoa === 'PJ' && clientesPJ().length > 0)" class="clientes-container">
        <div class="stats-bar">
          <div class="stats-info">
            <span class="stat-item">
              Total: {{ totalElements() }} clientes
            </span>
            <span class="stat-item">
              Página {{ currentPage() + 1 }} de {{ totalPages() }}
            </span>
          </div>
          <div class="status-filter">
            <span class="status-label">{{ statusFilter() === 'bloqueados' ? 'Bloqueados' : 'Ativos' }}</span>
            <button
              class="status-toggle-button"
              [class.blocked]="statusFilter() === 'bloqueados'"
              (click)="toggleStatusFilter()"
              aria-label="Alternar filtro de ativos/bloqueados"
              [attr.aria-pressed]="statusFilter() === 'bloqueados'">
              <div class="toggle-slider">
                <div class="toggle-knob">
                  <svg *ngIf="statusFilter() === 'bloqueados'" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                  </svg>
                  <svg *ngIf="statusFilter() === 'ativos'" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="20 6 9 17 4 12"></polyline>
                  </svg>
                </div>
              </div>
            </button>
          </div>
          <div class="page-size-selector">
            <label for="pageSize">Cards por página:</label>
            <select
              id="pageSize"
              [(ngModel)]="pageSize"
              (ngModelChange)="changePageSize($event)"
              class="page-size-select">
              <option *ngFor="let size of pageSizeOptions" [value]="size">{{ size }}</option>
            </select>
          </div>
        </div>

        <div class="clientes-grid">
          <ng-container *ngIf="tipoPessoa === 'PF'">
            <div *ngFor="let cliente of clientesPF()"
                 class="cliente-card"
                 (click)="viewClienteDetails(cliente)">
              <div class="card-header">
                <h3>{{ $any(cliente).nomeCompleto }}</h3>
                <span class="status-badge" [class.blocked]="$any(cliente).bloqueado">
                  <svg *ngIf="$any(cliente).bloqueado" class="status-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                  </svg>
                  <svg *ngIf="!$any(cliente).bloqueado" class="status-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="20 6 9 17 4 12"></polyline>
                  </svg>
                  {{ $any(cliente).bloqueado ? 'Bloqueado' : 'Ativo' }}
                </span>
              </div>
              <div class="card-body">
                <p class="card-field-with-copy">
                  <strong>CPF:</strong>
                  <span>{{ $any(cliente).cpf }}</span>
                  <button
                    class="copy-icon-btn"
                    (click)="copyToClipboard($any(cliente).cpf, 'CPF'); $event.stopPropagation()"
                    title="Copiar CPF">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                    </svg>
                  </button>
                </p>
                <p *ngIf="$any(cliente).email"><strong>Email:</strong> {{ $any(cliente).email }}</p>
              </div>
              <div class="card-footer">
                <span class="uuid-with-copy">
                  <small>UUID: {{ $any(cliente).publicId }}</small>
                  <button
                    class="copy-icon-btn small"
                    (click)="copyToClipboard($any(cliente).publicId, 'UUID'); $event.stopPropagation()"
                    title="Copiar UUID">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                    </svg>
                  </button>
                </span>
              </div>
            </div>
          </ng-container>

          <ng-container *ngIf="tipoPessoa === 'PJ'">
            <div *ngFor="let cliente of clientesPJ()"
                 class="cliente-card"
                 (click)="viewClienteDetails(cliente)">
              <div class="card-header">
                <h3>{{ $any(cliente).nomeFantasia }}</h3>
                <span class="status-badge" [class.blocked]="$any(cliente).bloqueado">
                  <svg *ngIf="$any(cliente).bloqueado" class="status-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                  </svg>
                  <svg *ngIf="!$any(cliente).bloqueado" class="status-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="20 6 9 17 4 12"></polyline>
                  </svg>
                  {{ $any(cliente).bloqueado ? 'Bloqueado' : 'Ativo' }}
                </span>
              </div>
              <div class="card-body">
                <p class="card-field-with-copy">
                  <strong>CNPJ:</strong>
                  <span>{{ $any(cliente).cnpj }}</span>
                  <button
                    class="copy-icon-btn"
                    (click)="copyToClipboard($any(cliente).cnpj, 'CNPJ'); $event.stopPropagation()"
                    title="Copiar CNPJ">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                    </svg>
                  </button>
                </p>
                <p *ngIf="$any(cliente).email"><strong>Email:</strong> {{ $any(cliente).email }}</p>
                <p *ngIf="$any(cliente).razaoSocial">
                  <strong>Razão Social:</strong> {{ $any(cliente).razaoSocial }}
                </p>
              </div>
              <div class="card-footer">
                <span class="uuid-with-copy">
                  <small>UUID: {{ $any(cliente).publicId }}</small>
                  <button
                    class="copy-icon-btn small"
                    (click)="copyToClipboard($any(cliente).publicId, 'UUID'); $event.stopPropagation()"
                    title="Copiar UUID">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                    </svg>
                  </button>
                </span>
              </div>
            </div>
          </ng-container>
        </div>

        <div class="pagination" *ngIf="totalPages() > 1">
          <button
            class="page-btn prev-next"
            [disabled]="currentPage() === 0"
            (click)="previousPage()">
            ‹ Anterior
          </button>

          <ng-container *ngFor="let page of getPageNumbers()">
            <button
              *ngIf="page !== '...'"
              class="page-number-btn"
              [class.active]="page === currentPage()"
              (click)="goToPage(+page)">
              {{ +page + 1 }}
            </button>
            <span *ngIf="page === '...'" class="page-ellipsis">...</span>
          </ng-container>

          <button
            class="page-btn prev-next"
            [disabled]="currentPage() >= totalPages() - 1"
            (click)="nextPage()">
            Próxima ›
          </button>
        </div>
      </div>
    </div>

    <!-- Buscar por CPF/CNPJ -->
    <div *ngIf="activeAction === 'searchByCpfCnpj' && !loading()" class="action-content">
      <div class="content-header">
        <h2>Buscar Cliente por {{ tipoPessoa === 'PF' ? 'CPF' : 'CNPJ' }}</h2>
      </div>

      <div class="search-form">
        <div class="form-group">
          <label>{{ tipoPessoa === 'PF' ? 'CPF' : 'CNPJ' }}</label>
          <input
            type="text"
            [(ngModel)]="searchTerm"
            [placeholder]="tipoPessoa === 'PF' ? 'Digite o CPF (somente números)' : 'Digite o CNPJ (somente números)'"
            class="form-input"
            (keyup.enter)="searchByCpfOrCnpj()">
        </div>
        <button class="action-btn primary" (click)="searchByCpfOrCnpj()">
          <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
          Buscar
        </button>
      </div>
    </div>

    <!-- Buscar por UUID -->
    <div *ngIf="activeAction === 'searchByUuid' && !loading()" class="action-content">
      <div class="content-header">
        <h2>Buscar Cliente por UUID</h2>
      </div>

      <div class="search-form">
        <div class="form-group">
          <label>UUID do Cliente</label>
          <input
            type="text"
            [(ngModel)]="uuidSearch"
            placeholder="Digite o UUID (ex: cd15550c-c146-4ed8-b141-3f3347dca756)"
            class="form-input"
            (keyup.enter)="searchByUuid()">
        </div>
        <button class="action-btn primary" (click)="searchByUuid()">
          <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
          Buscar
        </button>
      </div>
    </div>

    <!-- Reset de Senha -->
    <div *ngIf="activeAction === 'passwordReset' && !loading()" class="action-content">
      <div class="content-header">
        <h2>Reset de Senha</h2>
      </div>

      <div class="search-form">
        <div class="form-group">
          <label>UUID do Usuário</label>
          <input
            type="text"
            [(ngModel)]="passwordResetUuid"
            placeholder="Digite o UUID do usuário"
            class="form-input"
            (keyup.enter)="searchUserForPasswordReset()">
        </div>
        <button class="action-btn primary" (click)="searchUserForPasswordReset()">
          <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
          Buscar Usuário
        </button>
      </div>
    </div>

    <!-- Relatório de Leads -->
    <div *ngIf="activeAction === 'reportLeads' && !loading()" class="action-content">
      <div class="content-header">
        <h2>Relatório de Leads</h2>
        <p class="report-subtitle">Origem dos leads por fonte de aquisição</p>
      </div>

      <!-- Conteúdo do relatório -->
      <div class="report-container" [style.display]="leadsData.length > 0 ? 'flex' : 'none'">
        <div class="chart-card">
          <h3 class="chart-title">Distribuição de Leads por Origem</h3>
          <!-- Overlay de loading acima do gráfico até a animação terminar -->
          <div *ngIf="isLoadingLeads()" class="report-loading overlay">
            <app-loading message="Carregando dados de leads..." size="large" type="progress-bar"></app-loading>
          </div>
          <div class="chart-wrapper">
            <div #leadsChart></div>
          </div>
          <div class="chart-legend">
            <div *ngFor="let source of leadsData; let i = index"
                 class="legend-item"
                 [class.selected]="selectedLeadIndex() === i"
                 (click)="onSelectLead(i)">
              <span class="legend-color" [style.background-color]="source.color"></span>
              <span class="legend-label">{{ source.label }}</span>
              <span class="legend-value">{{ source.percentage }}% ({{ source.value }} leads)</span>
            </div>
          </div>
        </div>

        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon primary">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="8.5" cy="7" r="4"></circle>
                <path d="M20 8v6M23 11h-6"></path>
              </svg>
            </div>
            <div class="stat-content">
              <h4>Total de Leads</h4>
              <p class="stat-number">{{ getTotalLeads() }}</p>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon success">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
              </svg>
            </div>
            <div class="stat-content">
              <h4>Principal Origem</h4>
              <p class="stat-number">{{ getTopLeadSource() }}</p>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon warning">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="16" x2="12" y2="12"></line>
                <line x1="12" y1="8" x2="12.01" y2="8"></line>
              </svg>
            </div>
            <div class="stat-content">
              <h4>Fontes Distintas</h4>
              <p class="stat-number">{{ leadsData.length }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Mensagem quando não há dados -->
      <div *ngIf="!isLoadingLeads() && leadsData.length === 0" class="no-data-message">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
        <h3>Nenhum lead encontrado</h3>
        <p>Não há dados de origem de leads disponíveis no momento.</p>
      </div>
    </div>
  </main>
</div>

<!-- Modal de Detalhes -->
<div *ngIf="showDetail()" class="modal-overlay" [class.closing]="isClosingDetail()" (click)="closeDetail()">
  <div class="modal-content" [class.closing]="isClosingDetail()" (click)="$event.stopPropagation()">
    <!-- Container com slide animation -->
    <div class="modal-slider" [class.transitioning]="isSliderTransitioning()" [class.returning]="isSliderTransitioning() && !showBloqueioForm() && !showDeleteForm()" [class.show-bloqueio]="showBloqueioForm()" [class.show-delete]="showDeleteForm()">

      <!-- Tela Principal (Detalhes do Cliente) -->
      <div class="modal-slide modal-slide-main">
        <div class="modal-header">
          <h2>Detalhes do Cliente</h2>
          <button class="close-btn" (click)="closeDetail()">✕</button>
        </div>

        <div class="modal-body">
      <!-- MODAL MÍNIMO (Listagem e Busca por CPF/CNPJ) -->
      <div *ngIf="selectedCliente() && !isFullDetail()" class="detail-grid-minimal">
        <!-- UUID com botão de copiar (sem ícone) -->
        <div class="detail-item-copy-clean">
          <div class="detail-info">
            <strong>UUID</strong>
            <span class="copy-text">{{ $any(selectedCliente()).publicId }}</span>
          </div>
          <button
            class="copy-btn-clean"
            (click)="copyToClipboard($any(selectedCliente()).publicId, 'UUID')"
            title="Copiar UUID">
            Copiar
          </button>
        </div>

        <!-- Login do Usuário (user-core) - LGPD Compliant -->
        <div *ngIf="selectedClienteUser()" class="detail-item user-info-highlight">
          <strong>Login (User-Core):</strong>
          <span class="masked-data">{{ maskedClienteLogin() }}</span>
        </div>

        <!-- Dados para Pessoa Física -->
        <div *ngIf="tipoPessoa === 'PF'">
          <div class="detail-item">
            <strong>Primeiro Nome:</strong>
            <span>{{ $any(selectedCliente()).primeiroNome }}</span>
          </div>
          <div class="detail-item">
            <strong>Sobrenome:</strong>
            <span>{{ $any(selectedCliente()).sobrenome }}</span>
          </div>

          <!-- CPF com botão de copiar (sem ícone) -->
          <div class="detail-item-copy-clean">
            <div class="detail-info">
              <strong>CPF</strong>
              <span class="copy-text">{{ $any(selectedCliente()).cpf }}</span>
            </div>
            <button
              class="copy-btn-clean"
              (click)="copyToClipboard($any(selectedCliente()).cpf, 'CPF')"
              title="Copiar CPF">
              Copiar
            </button>
          </div>
        </div>

        <!-- Dados para Pessoa Jurídica -->
        <div *ngIf="tipoPessoa === 'PJ'">
          <div class="detail-item">
            <strong>Nome Fantasia:</strong>
            <span>{{ $any(selectedCliente()).nomeFantasia }}</span>
          </div>

          <!-- CNPJ com botão de copiar (sem ícone) -->
          <div class="detail-item-copy-clean">
            <div class="detail-info">
              <strong>CNPJ</strong>
              <span class="copy-text">{{ $any(selectedCliente()).cnpj }}</span>
            </div>
            <button
              class="copy-btn-clean"
              (click)="copyToClipboard($any(selectedCliente()).cnpj, 'CNPJ')"
              title="Copiar CNPJ">
              Copiar
            </button>
          </div>
        </div>
      </div>

      <!-- MODAL COMPLETO (Busca por UUID) -->
      <div *ngIf="selectedCliente() && isFullDetail()" class="detail-grid-full">
        <!-- UUID com botão de copiar -->
        <div class="detail-item-copy-clean">
          <div class="detail-info">
            <strong>UUID</strong>
            <span class="copy-text">{{ $any(selectedCliente()).publicId }}</span>
          </div>
          <button
            class="copy-btn-clean"
            (click)="copyToClipboard($any(selectedCliente()).publicId, 'UUID')"
            title="Copiar UUID">
            Copiar
          </button>
        </div>

        <!-- Login do Usuário (user-core) - LGPD Compliant -->
        <div *ngIf="selectedClienteUser()" class="detail-item user-info-highlight">
          <strong>Login (User-Core):</strong>
          <span class="masked-data">{{ maskedClienteLogin() }}</span>
        </div>

        <!-- DADOS PARA PESSOA FÍSICA -->
        <div *ngIf="tipoPessoa === 'PF'">
          <!-- Seção: Dados Pessoais -->
          <div class="detail-section">
            <h3 class="section-title">Dados Pessoais</h3>
            <div class="section-content">
              <div class="detail-item">
                <strong>Nome Completo:</strong>
                <span>{{ $any(selectedCliente()).nomeCompleto }}</span>
              </div>
              <div class="detail-item">
                <strong>Primeiro Nome:</strong>
                <span>{{ $any(selectedCliente()).primeiroNome }}</span>
              </div>
              <div class="detail-item" *ngIf="$any(selectedCliente()).nomeDoMeio">
                <strong>Nome do Meio:</strong>
                <span>{{ $any(selectedCliente()).nomeDoMeio }}</span>
              </div>
              <div class="detail-item">
                <strong>Sobrenome:</strong>
                <span>{{ $any(selectedCliente()).sobrenome }}</span>
              </div>
              <div class="detail-item-copy-clean">
                <div class="detail-info">
                  <strong>CPF</strong>
                  <span class="copy-text">{{ $any(selectedCliente()).cpf }}</span>
                </div>
                <button
                  class="copy-btn-clean"
                  (click)="copyToClipboard($any(selectedCliente()).cpf, 'CPF')"
                  title="Copiar CPF">
                  Copiar
                </button>
              </div>
              <div class="detail-item" *ngIf="$any(selectedCliente()).rg">
                <strong>RG:</strong>
                <span>{{ $any(selectedCliente()).rg }}</span>
              </div>
              <div class="detail-item" *ngIf="$any(selectedCliente()).dataNascimento">
                <strong>Data de Nascimento:</strong>
                <span>{{ $any(selectedCliente()).dataNascimento }}</span>
              </div>
              <div class="detail-item" *ngIf="$any(selectedCliente()).idade">
                <strong>Idade:</strong>
                <span>{{ $any(selectedCliente()).idade }} anos</span>
              </div>
              <div class="detail-item" *ngIf="$any(selectedCliente()).sexo">
                <strong>Sexo:</strong>
                <span>{{ $any(selectedCliente()).sexo }}</span>
              </div>
            </div>
          </div>

          <!-- Seção: Filiação e Estado Civil -->
          <div class="detail-section" *ngIf="$any(selectedCliente()).nomeMae || $any(selectedCliente()).nomePai || $any(selectedCliente()).estadoCivil">
            <h3 class="section-title">Filiação e Estado Civil</h3>
            <div class="section-content">
              <div class="detail-item" *ngIf="$any(selectedCliente()).nomeMae">
                <strong>Nome da Mãe:</strong>
                <span>{{ $any(selectedCliente()).nomeMae }}</span>
              </div>
              <div class="detail-item" *ngIf="$any(selectedCliente()).nomePai">
                <strong>Nome do Pai:</strong>
                <span>{{ $any(selectedCliente()).nomePai }}</span>
              </div>
              <div class="detail-item" *ngIf="$any(selectedCliente()).estadoCivil">
                <strong>Estado Civil:</strong>
                <span>{{ $any(selectedCliente()).estadoCivil }}</span>
              </div>
            </div>
          </div>

          <!-- Seção: Informações Profissionais -->
          <div class="detail-section" *ngIf="$any(selectedCliente()).profissao || $any(selectedCliente()).nacionalidade || $any(selectedCliente()).naturalidade">
            <h3 class="section-title">Informações Profissionais e Origem</h3>
            <div class="section-content">
              <div class="detail-item" *ngIf="$any(selectedCliente()).profissao">
                <strong>Profissão:</strong>
                <span>{{ $any(selectedCliente()).profissao }}</span>
              </div>
              <div class="detail-item" *ngIf="$any(selectedCliente()).nacionalidade">
                <strong>Nacionalidade:</strong>
                <span>{{ $any(selectedCliente()).nacionalidade }}</span>
              </div>
              <div class="detail-item" *ngIf="$any(selectedCliente()).naturalidade">
                <strong>Naturalidade:</strong>
                <span>{{ $any(selectedCliente()).naturalidade }}</span>
              </div>
            </div>
          </div>

          <!-- Seção: Contatos -->
          <div class="detail-section">
            <h3 class="section-title">Contatos</h3>
            <div class="section-content">
              <div class="detail-item" *ngIf="$any(selectedCliente()).email">
                <strong>Email:</strong>
                <span>{{ $any(selectedCliente()).email }}</span>
              </div>
              <p *ngIf="!$any(selectedCliente()).email" class="no-data">Nenhum contato cadastrado</p>
            </div>
          </div>

          <!-- Seção: Informações Comerciais -->
          <div class="detail-section">
            <h3 class="section-title">Informações Comerciais</h3>
            <div class="section-content">
              <div class="detail-item" *ngIf="$any(selectedCliente()).tipoCliente">
                <strong>Tipo de Cliente:</strong>
                <span>{{ $any(selectedCliente()).tipoCliente }}</span>
              </div>
              <div class="detail-item" *ngIf="$any(selectedCliente()).origemLead">
                <strong>Origem Lead:</strong>
                <span>{{ $any(selectedCliente()).origemLead }}</span>
              </div>
              <div class="detail-item" *ngIf="$any(selectedCliente()).totalComprasRealizadas !== undefined">
                <strong>Total de Compras:</strong>
                <span>{{ $any(selectedCliente()).totalComprasRealizadas }}</span>
              </div>
              <div class="detail-item" *ngIf="$any(selectedCliente()).totalVendasRealizadas !== undefined">
                <strong>Total de Vendas:</strong>
                <span>{{ $any(selectedCliente()).totalVendasRealizadas }}</span>
              </div>
              <div class="detail-item" *ngIf="$any(selectedCliente()).valorTotalComprado !== undefined">
                <strong>Valor Total Comprado:</strong>
                <span>R$ {{ $any(selectedCliente()).valorTotalComprado }}</span>
              </div>
              <div class="detail-item" *ngIf="$any(selectedCliente()).valorTotalVendido !== undefined">
                <strong>Valor Total Vendido:</strong>
                <span>R$ {{ $any(selectedCliente()).valorTotalVendido }}</span>
              </div>
            </div>
          </div>

          <!-- Seção: Status e Observações -->
          <div class="detail-section">
            <h3 class="section-title">Status e Observações</h3>
            <div class="section-content">
              <div class="detail-item">
                <strong>Status:</strong>
                <span [class.text-danger]="$any(selectedCliente()).bloqueado">
                  {{ $any(selectedCliente()).bloqueado ? 'Bloqueado' : 'Ativo' }}
                </span>
              </div>
              <div class="detail-item" *ngIf="$any(selectedCliente()).motivoBloqueio">
                <strong>Motivo Bloqueio:</strong>
                <span class="text-danger">{{ $any(selectedCliente()).motivoBloqueio }}</span>
              </div>
              <div class="detail-item" *ngIf="$any(selectedCliente()).observacoes">
                <strong>Observações:</strong>
                <span>{{ $any(selectedCliente()).observacoes }}</span>
              </div>
              <div class="detail-item" *ngIf="$any(selectedCliente()).dataCriacao">
                <strong>Data de Criação:</strong>
                <span>{{ $any(selectedCliente()).dataCriacao }}</span>
              </div>
              <div class="detail-item" *ngIf="$any(selectedCliente()).dataAtualizacao">
                <strong>Última Atualização:</strong>
                <span>{{ $any(selectedCliente()).dataAtualizacao }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- DADOS PARA PESSOA JURÍDICA -->
        <div *ngIf="tipoPessoa === 'PJ'">
          <!-- Seção: Dados da Empresa -->
          <div class="detail-section">
            <h3 class="section-title">Dados da Empresa</h3>
            <div class="section-content">
              <div class="detail-item">
                <strong>Razão Social:</strong>
                <span>{{ $any(selectedCliente()).razaoSocial }}</span>
              </div>
              <div class="detail-item">
                <strong>Nome Fantasia:</strong>
                <span>{{ $any(selectedCliente()).nomeFantasia }}</span>
              </div>
              <div class="detail-item">
                <strong>Nome de Exibição:</strong>
                <span>{{ $any(selectedCliente()).nomeExibicao }}</span>
              </div>
              <div class="detail-item-copy-clean">
                <div class="detail-info">
                  <strong>CNPJ</strong>
                  <span class="copy-text">{{ $any(selectedCliente()).cnpj }}</span>
                </div>
                <button
                  class="copy-btn-clean"
                  (click)="copyToClipboard($any(selectedCliente()).cnpj, 'CNPJ')"
                  title="Copiar CNPJ">
                  Copiar
                </button>
              </div>
              <div class="detail-item" *ngIf="$any(selectedCliente()).inscricaoEstadual">
                <strong>Inscrição Estadual:</strong>
                <span>{{ $any(selectedCliente()).inscricaoEstadual }}</span>
              </div>
              <div class="detail-item" *ngIf="$any(selectedCliente()).inscricaoMunicipal">
                <strong>Inscrição Municipal:</strong>
                <span>{{ $any(selectedCliente()).inscricaoMunicipal }}</span>
              </div>
              <div class="detail-item" *ngIf="$any(selectedCliente()).dataAbertura">
                <strong>Data de Abertura:</strong>
                <span>{{ $any(selectedCliente()).dataAbertura }}</span>
              </div>
            </div>
          </div>

          <!-- Seção: Informações Empresariais -->
          <div class="detail-section">
            <h3 class="section-title">Informações Empresariais</h3>
            <div class="section-content">
              <div class="detail-item" *ngIf="$any(selectedCliente()).porteEmpresa">
                <strong>Porte da Empresa:</strong>
                <span>{{ $any(selectedCliente()).porteEmpresa }}</span>
              </div>
              <div class="detail-item" *ngIf="$any(selectedCliente()).naturezaJuridica">
                <strong>Natureza Jurídica:</strong>
                <span>{{ $any(selectedCliente()).naturezaJuridica }}</span>
              </div>
              <div class="detail-item" *ngIf="$any(selectedCliente()).atividadePrincipal">
                <strong>Atividade Principal:</strong>
                <span>{{ $any(selectedCliente()).atividadePrincipal }}</span>
              </div>
              <div class="detail-item" *ngIf="$any(selectedCliente()).capitalSocial !== undefined">
                <strong>Capital Social:</strong>
                <span>R$ {{ $any(selectedCliente()).capitalSocial }}</span>
              </div>
            </div>
          </div>

          <!-- Seção: Responsável -->
          <div class="detail-section" *ngIf="$any(selectedCliente()).nomeResponsavel || $any(selectedCliente()).cpfResponsavel || $any(selectedCliente()).cargoResponsavel">
            <h3 class="section-title">Responsável</h3>
            <div class="section-content">
              <div class="detail-item" *ngIf="$any(selectedCliente()).nomeResponsavel">
                <strong>Nome:</strong>
                <span>{{ $any(selectedCliente()).nomeResponsavel }}</span>
              </div>
              <div class="detail-item" *ngIf="$any(selectedCliente()).cpfResponsavel">
                <strong>CPF:</strong>
                <span>{{ $any(selectedCliente()).cpfResponsavel }}</span>
              </div>
              <div class="detail-item" *ngIf="$any(selectedCliente()).cargoResponsavel">
                <strong>Cargo:</strong>
                <span>{{ $any(selectedCliente()).cargoResponsavel }}</span>
              </div>
            </div>
          </div>

          <!-- Seção: Contatos -->
          <div class="detail-section">
            <h3 class="section-title">Contatos</h3>
            <div class="section-content">
              <div class="detail-item" *ngIf="$any(selectedCliente()).email">
                <strong>Email:</strong>
                <span>{{ $any(selectedCliente()).email }}</span>
              </div>
              <div class="detail-item" *ngIf="$any(selectedCliente()).site">
                <strong>Site:</strong>
                <span>{{ $any(selectedCliente()).site }}</span>
              </div>
              <p *ngIf="!$any(selectedCliente()).email && !$any(selectedCliente()).site" class="no-data">Nenhum contato cadastrado</p>
            </div>
          </div>

          <!-- Seção: Informações Comerciais -->
          <div class="detail-section">
            <h3 class="section-title">Informações Comerciais</h3>
            <div class="section-content">
              <div class="detail-item" *ngIf="$any(selectedCliente()).tipoCliente">
                <strong>Tipo de Cliente:</strong>
                <span>{{ $any(selectedCliente()).tipoCliente }}</span>
              </div>
              <div class="detail-item" *ngIf="$any(selectedCliente()).origemLead">
                <strong>Origem Lead:</strong>
                <span>{{ $any(selectedCliente()).origemLead }}</span>
              </div>
              <div class="detail-item" *ngIf="$any(selectedCliente()).totalComprasRealizadas !== undefined">
                <strong>Total de Compras:</strong>
                <span>{{ $any(selectedCliente()).totalComprasRealizadas }}</span>
              </div>
              <div class="detail-item" *ngIf="$any(selectedCliente()).totalVendasRealizadas !== undefined">
                <strong>Total de Vendas:</strong>
                <span>{{ $any(selectedCliente()).totalVendasRealizadas }}</span>
              </div>
              <div class="detail-item" *ngIf="$any(selectedCliente()).valorTotalComprado !== undefined">
                <strong>Valor Total Comprado:</strong>
                <span>R$ {{ $any(selectedCliente()).valorTotalComprado }}</span>
              </div>
              <div class="detail-item" *ngIf="$any(selectedCliente()).valorTotalVendido !== undefined">
                <strong>Valor Total Vendido:</strong>
                <span>R$ {{ $any(selectedCliente()).valorTotalVendido }}</span>
              </div>
            </div>
          </div>

          <!-- Seção: Status e Observações -->
          <div class="detail-section">
            <h3 class="section-title">Status e Observações</h3>
            <div class="section-content">
              <div class="detail-item">
                <strong>Status:</strong>
                <span [class.text-danger]="$any(selectedCliente()).bloqueado">
                  {{ $any(selectedCliente()).bloqueado ? 'Bloqueado' : 'Ativo' }}
                </span>
              </div>
              <div class="detail-item" *ngIf="$any(selectedCliente()).motivoBloqueio">
                <strong>Motivo Bloqueio:</strong>
                <span class="text-danger">{{ $any(selectedCliente()).motivoBloqueio }}</span>
              </div>
              <div class="detail-item" *ngIf="$any(selectedCliente()).observacoes">
                <strong>Observações:</strong>
                <span>{{ $any(selectedCliente()).observacoes }}</span>
              </div>
              <div class="detail-item" *ngIf="$any(selectedCliente()).dataCriacao">
                <strong>Data de Criação:</strong>
                <span>{{ $any(selectedCliente()).dataCriacao }}</span>
              </div>
              <div class="detail-item" *ngIf="$any(selectedCliente()).dataAtualizacao">
                <strong>Última Atualização:</strong>
                <span>{{ $any(selectedCliente()).dataAtualizacao }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

        <div class="modal-footer">
          <div class="modal-actions-left">
            <button class="action-btn danger" (click)="confirmDelete()" title="Deletar cliente">
              <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg>
              Deletar
            </button>
            <button
              *ngIf="$any(selectedCliente()).bloqueado"
              class="action-btn warning"
              (click)="confirmDesbloquear()"
              title="Desbloquear cliente">
              <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                <path d="M7 11V7a5 5 0 0 1 9.9-1"></path>
              </svg>
              Desbloquear
            </button>
            <button
              *ngIf="!$any(selectedCliente()).bloqueado"
              class="action-btn warning"
              (click)="confirmBloquear()"
              title="Bloquear cliente">
              <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
              </svg>
              Bloquear
            </button>
          </div>
          <div class="modal-actions-right">
            <button class="action-btn secondary" (click)="closeDetail()">Fechar</button>
          </div>
        </div>
      </div>
      <!-- Fim Tela Principal -->

      <!-- Tela de Bloqueio -->
      <div class="modal-slide modal-slide-bloqueio">
        <div class="modal-header">
          <button class="back-btn" (click)="cancelarBloqueio()" title="Voltar">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="19" y1="12" x2="5" y2="12"></line>
              <polyline points="12 19 5 12 12 5"></polyline>
            </svg>
          </button>
          <h2>Bloquear Cliente</h2>
          <button class="close-btn" (click)="closeDetail()">✕</button>
        </div>

        <div class="modal-body">
          <div class="bloqueio-form">
            <div class="bloqueio-warning">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
              </svg>
              <p>
                Você está prestes a bloquear o cliente
                <strong>{{ tipoPessoa === 'PF'
                  ? ($any(selectedCliente())?.primeiroNome + ' ' + $any(selectedCliente())?.sobrenome)
                  : $any(selectedCliente())?.nomeFantasia }}</strong>.
              </p>
              <p>Esta ação impedirá novas transações com este cliente.</p>
            </div>

            <div class="form-group">
              <label for="motivoBloqueio">Motivo do Bloqueio *</label>
              <textarea
                id="motivoBloqueio"
                [(ngModel)]="motivoBloqueio"
                rows="5"
                placeholder="Digite o motivo do bloqueio do cliente..."
                class="form-control"></textarea>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <div class="modal-actions-left">
            <button class="action-btn secondary" (click)="cancelarBloqueio()">
              Cancelar
            </button>
          </div>
          <div class="modal-actions-right">
            <button class="action-btn danger" (click)="executarBloqueio()">
              <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
              </svg>
              Confirmar Bloqueio
            </button>
          </div>
        </div>
      </div>
      <!-- Fim Tela de Bloqueio -->

      <!-- Tela de Deletar -->
      <div class="modal-slide modal-slide-delete">
        <div class="modal-header">
          <button class="back-btn" (click)="cancelarDelete()" title="Voltar">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="19" y1="12" x2="5" y2="12"></line>
              <polyline points="12 19 5 12 12 5"></polyline>
            </svg>
          </button>
          <h2>Deletar Cliente</h2>
          <button class="close-btn" (click)="closeDetail()">✕</button>
        </div>

        <div class="modal-body">
          <div class="delete-form">
            <div class="delete-warning">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="15" y1="9" x2="9" y2="15"></line>
                <line x1="9" y1="9" x2="15" y2="15"></line>
              </svg>
              <p>
                <strong>ATENÇÃO!</strong> Você está prestes a deletar o cliente
                <strong>{{ tipoPessoa === 'PF'
                  ? ($any(selectedCliente())?.primeiroNome + ' ' + $any(selectedCliente())?.sobrenome)
                  : $any(selectedCliente())?.nomeFantasia }}</strong>.
              </p>
              <p>Esta ação é <strong>IRREVERSÍVEL</strong> e todos os dados do cliente serão removidos do sistema.</p>
            </div>

            <div class="form-group">
              <label for="motivoDelete">Motivo da Exclusão *</label>
              <textarea
                id="motivoDelete"
                [(ngModel)]="motivoDelete"
                rows="5"
                placeholder="Digite o motivo da exclusão do cliente..."
                class="form-control"></textarea>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <div class="modal-actions-left">
            <button class="action-btn secondary" (click)="cancelarDelete()">
              Cancelar
            </button>
          </div>
          <div class="modal-actions-right">
            <button class="action-btn danger" (click)="executarDelete()">
              <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg>
              Confirmar Exclusão
            </button>
          </div>
        </div>
      </div>
      <!-- Fim Tela de Deletar -->

    </div>
    <!-- Fim modal-slider -->
  </div>
</div>

<!-- Modal de Reset de Senha -->
<div *ngIf="showPasswordResetModal()" class="modal-overlay" (click)="closePasswordResetModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Reset de Senha</h2>
      <button class="close-btn" (click)="closePasswordResetModal()">✕</button>
    </div>

    <div class="modal-body">
      <div class="detail-grid-minimal">
        <!-- Login com asteriscos (LGPD) -->
        <div class="detail-item">
          <strong>Login:</strong>
          <span>{{ maskedLogin() }}</span>
        </div>

        <div class="detail-item">
          <strong>Email:</strong>
          <span>{{ selectedUser()?.email || 'Não cadastrado' }}</span>
        </div>

        <div class="detail-item">
          <strong>2FA Ativado:</strong>
          <span>{{ selectedUser()?.twoFactorEnabled ? 'Sim' : 'Não' }}</span>
        </div>

        <div class="detail-item">
          <strong>Tema:</strong>
          <span>{{ selectedUser()?.theme === 'DARK' ? 'Escuro' : 'Claro' }}</span>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <div class="modal-actions-left">
        <button class="action-btn primary" (click)="sendPasswordResetEmail()" [disabled]="!selectedUser()?.email">
          <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
            <polyline points="22,6 12,13 2,6"></polyline>
          </svg>
          Enviar Email Reset
        </button>
        <button class="action-btn warning" (click)="showManualResetForm.set(true)">
          <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/>
          </svg>
          Reset Manual
        </button>
      </div>
      <div class="modal-actions-right">
        <button class="action-btn secondary" (click)="closePasswordResetModal()">Fechar</button>
      </div>
    </div>

    <!-- Form de Reset Manual (aparece quando botão clicado) -->
    <div class="manual-reset-form" [class.show]="showManualResetForm()">
      <div class="form-group">
        <label>Nova Senha</label>
        <input
          type="password"
          [(ngModel)]="manualResetPassword"
          placeholder="Digite a nova senha"
          class="form-input">
      </div>
      <div class="form-group">
        <label>Confirmar Senha</label>
        <input
          type="password"
          [(ngModel)]="manualResetPasswordConfirm"
          placeholder="Confirme a nova senha"
          class="form-input">
      </div>
      <div class="manual-reset-actions">
        <button class="action-btn secondary" (click)="showManualResetForm.set(false)">Cancelar</button>
        <button class="action-btn danger" (click)="executeManualReset()">Confirmar Reset</button>
      </div>
    </div>
  </div>
</div>
<!-- Fim Modal de Reset de Senha -->
